{% extends "lk/lk.html" %}
{% load static %}
{% load tz %}
{% load django_vite %}
{% vite_hmr_client %}

{% block head_js_scripts %}
{% vite_asset 'apps/managers/assets/js/dashboard/dashboard.js' %}
{% endblock head_js_scripts %}

{% block title %}Панель управления{% endblock title %}

{% block header %}
{% include "managers/header/header.html" %}
{% endblock %}

{% block main_class %}bg-base-200 min-h-screen{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-6 max-w-7xl">
    <div id="dashboard">
        <div class="mb-8">
            <h1 class="text-3xl font-bold">Добро пожаловать{% if request.user.first_name %}, {{ request.user.first_name }}{% endif %}!</h1>
            <p class="text-base-content/60">Менеджер поддержки с {{ request.user.date_joined|timezone:"Europe/Moscow"|date:"j E Y H:i" }}</p>
        </div>

        <!-- Stats Cards -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <div class="card bg-gradient-to-r from-primary to-secondary text-white">
                <div class="card-body">
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="text-sm opacity-80">Проектов на модерации</p>
                            <p class="text-2xl font-bold">{{ pending_projects_count }}</p>
                        </div>
                        <i class="fas fa-clock text-3xl opacity-80"></i>
                    </div>
                </div>
            </div>

            <div class="card bg-gradient-to-r from-accent to-info text-white">
                <div class="card-body">
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="text-sm opacity-80">Площадок на модерации</p>
                            <p class="text-2xl font-bold">{{ pending_platforms_count }}</p>
                        </div>
                        <i class="fas fa-receipt text-3xl opacity-80"></i>
                    </div>
                </div>
            </div>

            <div class="card bg-gradient-to-r from-success to-warning text-white">
                <div class="card-body">
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="text-sm opacity-80">Заявок на выплату средств</p>
                            <p class="text-2xl font-bold">{{ partner_transactions_count }}</p>
                        </div>
                        <i class="fas fa-money-bill text-3xl opacity-80"></i>
                    </div>
                </div>
            </div>

            <div class="card bg-gradient-to-r from-warning to-error text-white">
                <div class="card-body">
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="text-sm opacity-80">Заявок на пополнение баланса</p>
                            <p class="text-2xl font-bold">{{ advertiser_transactions_count }}</p>
                        </div>
                        <i class="fas fa-money-bill text-3xl opacity-80"></i>
                    </div>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Left Column -->
            <div class="lg:col-span-2 space-y-6">
                <!-- Recent Actions -->
                <div class="card bg-base-100 shadow">
                    <div class="card-body">
                        <h2 class="card-title">
                            <i class="fas fa-history text-primary mr-2"></i>
                            Последняя активность
                        </h2>
                        <div class="space-y-4 max-h-96 overflow-y-auto">
                            {% for notification in notifications %}
                                <div class="flex items-center p-3 bg-warning/10 rounded-lg mr-2">
                                    {% if notification.activity_type == 'project' %}
                                        <div
                                            class="w-10 h-10 bg-info text-info-content rounded-full flex items-center justify-center mr-3">
                                            <i class="fa-solid fa-suitcase"></i>
                                        </div>
                                    {% elif notification.activity_type == 'platform' %}
                                        <div
                                            class="w-10 h-10 bg-info text-info-content rounded-full flex items-center justify-center mr-3">
                                            <i class="fas fa-globe"></i>
                                        </div>
                                    {% elif notification.activity_type == 'new_user' %}
                                        <div
                                            class="w-10 h-10 bg-success text-info-content rounded-full flex items-center justify-center mr-3">
                                            <i class="fa fa-user-plus"></i>
                                        </div>
                                    {% elif notification.activity_type == 'payout' %}
                                        <div
                                            class="w-10 h-10 bg-info text-info-content rounded-full flex items-center justify-center mr-3">
                                            <i class="fa-solid fa-credit-card"></i>
                                        </div>
                                    {% elif notification.activity_type == 'top_up' %}
                                        <div
                                            class="w-10 h-10 bg-info text-info-content rounded-full flex items-center justify-center mr-3">
                                            <i class="fas fa-money-bill-wave"></i>
                                        </div>
                                    {% elif notification.activity_type == 'review' %}
                                        <div
                                            class="w-10 h-10 bg-info text-info-content rounded-full flex items-center justify-center mr-3">
                                            <i class="fa-solid fa-comments"></i>
                                        </div> 
                                    {% elif notification.activity_type == 'system' %}
                                        <div
                                            class="w-10 h-10 bg-info text-info-content rounded-full flex items-center justify-center mr-3">
                                            <i class="fa fa-cog"></i>
                                        </div>
                                    {% elif notification.activity_type == 'other' %}
                                        <div
                                            class="w-10 h-10 bg-info text-info-content rounded-full flex items-center justify-center mr-3">
                                            <i class="fa fa-paper-plane"></i>
                                        </div>
                                    {% endif %}
                                    <div class="flex-1">
                                        <p class="font-medium">{{ notification.title }}</p>
                                        <p class="text-sm opacity-60">{{ notification.details }}</p>
                                    </div>
                                    <span class="text-sm text-base-content/60">{{ notification.created_at|timesince }} назад</span>
                                </div>
                            {% empty %}
                            <div class="flex flex-col justify-center items-center text-center py-10"
                                 id="empty-state">
                                <div class="text-gray-300 text-5xl mb-4">
                                    <i class="fas fa-sad-cry"></i>
                                </div>
                                <h3 class="text-lg font-medium text-gray-500 mb-2">Нет последних активностей</h3>
                                <p class="text-gray-400 text-sm mb-4">Здесь будут отображаться последние уведомления</p>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column -->
            <div class="space-y-6">
                <!-- Quick Actions -->
                <div class="card bg-base-100 shadow">
                    <div class="card-body">
                        <h2 class="card-title">
                            <i class="fas fa-bolt text-primary mr-2"></i>
                            Быстрые действия
                        </h2>
                        <div class="grid grid-cols-1 gap-2">
                            <button class="btn btn-outline justify-start" onclick="document.getElementById('projects-moderation-modal').show()">
                                <i class="fas fa-project-diagram mr-2"></i>
                                Модерация проектов
                            </button>
                            <button class="btn btn-outline justify-start" onclick="document.getElementById('platforms-moderation-modal').show()">
                                <i class="fas fa-project-diagram mr-2"></i>
                                Модерация площадок
                            </button>
                            <button class="btn btn-outline justify-start" onclick="document.getElementById('payouts-moderation-modal').show()">
                                <i class="fas fa-money-bill-wave mr-2"></i>
                                Модерация выплат партнёрам
                            </button>
                            <button class="btn btn-outline justify-start">
                                <i class="fas fa-money-bill-wave mr-2"></i>
                                Модерация пополнений у рекламодателей
                            </button>
                            <button class="btn btn-outline justify-start">
                                <i class="fas fa-star mr-2"></i>
                                Модерация отзывов
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


{% include "managers/dashboard/modals/projects.html" %}
{% include "managers/dashboard/modals/platforms.html" %}
{% include "managers/dashboard/modals/payouts.html" %}
{% include "managers/dashboard/modals/reviews.html" %}

{% endblock %}